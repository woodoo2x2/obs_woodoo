

Данные, хранимые в таблицах базы данных, часто бывают представлены не в том виде, в котором они необходимы. Например, в таблице, хранящей персональные данные людей, имя и фамилия человека могут находиться в разных полях, однако нам может потребоваться указать их в одном поле. Другим примером может являться таблица, хранящая детали интернет-заказа. В одном поле таблицы может находиться количество приобретенного товара, в другом — цена за единицу товара. Во время работы с такой таблицей закономерно может понадобиться общая стоимость — цена товара, умноженная на количество.

В каждом из рассмотренных примеров перед нами встает задача получения информации, которая не хранится в базе данных в явном виде, однако может быть получена путем различных манипуляций. Для решения подобной задачи используются **вычисляемые поля** — поля, значения которых не хранятся в таблице базы данных, а вычисляются автоматически на основе данных из других полей таблицы. Вычисляемые поля используются для извлечения информации с дополнительными преобразованиями, подсчетами или форматированием.

Вычисляемые поля определяются с использованием выражений, которые могут включать математические операции и вызовы различных функций. И если математические операции знакомы практически всем, то функции у неопытных студентов могут вызвать трудности. Поэтому в следующем абзаце мы предоставим ознакомительную информацию касательно функций, которой достаточно для понимания рассматриваемых в уроке примеров. 

**Функция** — программная единица, предназначенная для выполнения различных операций с данными. Например, функция может переводить символы строки в верхний регистр или возводить число в определенную степень. Каждая функция обладает **уникальным именем** и **набором аргументов**. Аргументы функции представляют собой данные, с которыми работает функция. Например, аргументами функции, возводящей число в определенную степень, являются само число и показатель степени.

Для вызова функции сначала указывается ее имя, а затем в скобках через запятую перечисляются все необходимые аргументы. Например, вызов функции `POW()` для возведения числа `5` во `2` степень выглядит следующим образом:

```python
POW(5, 2)
```

Псевдонимы вычисляемых полей, как и псевдонимы обычных полей, не могут быть использованы в блоке оператора `WHERE` для фильтрации записей.

Результатом приведенного ниже запроса:

```sql
SELECT artist, trackname,
       price * quantity AS revenue
FROM Songs
WHERE revenue > 20000;
```

является ошибка:

```no-highlight
ERROR 1054: Unknown column 'revenue' in 'where clause'
```

При необходимости выполнить фильтрацию по вычисляемому полю выражение, определяющее это поле, придется продублировать.

Результатом приведенного ниже запроса:

```sql
SELECT artist, trackname,
       price * quantity AS revenue
FROM Songs
WHERE price * quantity > 20000;
```

является:

```no-highlight
+-----------+----------------------+------------+
| artist    | trackname            | revenue    |
+-----------+----------------------+------------+
| Heart     | Crazy On You         | 62908.00   |
| Morrissey | Spent the Day in Bed | 2823985.00 |
+-----------+----------------------+------------+
```

Если псевдоним вычисляемого поля совпадает с именем одного из полей таблицы, то сортировка будет осуществляться по значениям вычисляемого поля.

Результатом приведенного ниже запроса:

```sql
SELECT CONCAT(artist, ': ',trackname) AS trackname
FROM Songs
ORDER BY trackname;
```

является:

```no-highlight
+---------------------------------+
| trackname                       |
+---------------------------------+
| Heart: Crazy On You             |
| Kate Bush: Running up That Hill |
| Morrissey: Spent the Day in Bed |
| The Sounds: My Lover            |
| The Sounds: Thrill              |
+---------------------------------+
```

Если необходимо осуществить сортировку по значениям поля таблицы, обращаться к полю следует через имя таблицы.

Результатом приведенного ниже запроса:

```sql
SELECT CONCAT(artist, ': ',trackname) AS trackname
FROM Songs
ORDER BY Songs.trackname;
```

является:

```no-highlight
+---------------------------------+
| trackname                       |
+---------------------------------+
| Heart: Crazy On You             |
| The Sounds: My Lover            |
| Kate Bush: Running up That Hill |
| Morrissey: Spent the Day in Bed |
| The Sounds: Thrill              |
+---------------------------------+
```

Обратите внимание, значения поля `trackname` стали отсортированы по названиям песен, а не по результатам конкатенации.

Если хотя бы один из аргументов, переданных в функцию `CONCAT()`, равняется `NULL`, функция вернет значение `NULL`.

Результатом приведенного ниже запроса:

```sql
SELECT CONCAT('one', NULL, 3) AS result;
```

является:

```no-highlight
+--------+
| result |
+--------+
| NULL   |
+--------+
```

Поскольку функции принимают значения и возвращают значения, возвращаемое значение одной функции может быть передано в качестве аргумента другой функции.

Результатом приведенного ниже запроса:

```sql
SELECT CONCAT('numbers: ', CONCAT_WS(', ', 1, 2, 3)) AS result;
```

является:

```no-highlight
+------------------+
| result           |
+------------------+
| numbers: 1, 2, 3 |
+------------------+
```

В данном примере сначала выполняется вложенная функция [[Функция CONCAT_WS]] и возвращает строку `1, 2, 3`. Затем полученная строка передается в функцию [[Функция CONCAT() (Объединение значений полей)|CONCAT()]] в качестве второго аргумента.