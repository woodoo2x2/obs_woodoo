
Функция `LAG()` используется для получения значения, которое содержится в определенном поле записи окна, отстающей от текущей на `n`. Например, запись окна, отстающая от текущей на `1`, считается предыдущей, на `2` — предпредыдущей, и так далее.

В качестве примера использования функции `LAG()` напишем запрос, который зарплате каждого сотрудника ставит в соответствие зарплату предыдущего сотрудника (сотрудника с идентификатором на единицу меньше).

Результатом приведенного ниже запроса:

```sql
SELECT id, full_name, salary,
       LAG(salary, 1) OVER (ORDER BY id) AS prev_employee_salary
FROM Employees;
```

является:

```no-highlight
+----+-----------------+--------+----------------------+
| id | full_name       | salary | prev_employee_salary |
+----+-----------------+--------+----------------------+
| 1  | Sergey Brin     | 10000  | NULL                 |
| 2  | John Doerr      | 10000  | 10000                |
| 3  | Larry Page      | 7000   | 10000                |
| 4  | Eric Schmidt    | 8000   | 7000                 |
| 5  | Sundar Pichai   | 11000  | 8000                 |
| 6  | Marissa Mayer   | 9000   | 11000                |
| 7  | Susan Wojcicki  | 8000   | 9000                 |
| 8  | John Smith      | 7000   | 8000                 |
| 9  | Sheryl Sandberg | 9000   | 7000                 |
| 10 | Alice Johnson   | 12000  | 9000                 |
+----+-----------------+--------+----------------------+
```

Обратите внимание, что функция `LAG()` возвращает значение `NULL`, если пытается получить значение записи, выходящей за рамки окна. Так, в примере выше для первого сотрудника зарплатой предыдущего сотрудника считается `NULL`.

В случае выхода за рамки окна функция `LAG()` умеет возвращать не только `NULL`, но и любое другое значение. Для этого при вызове функции достаточно указать необходимое значение в качестве третьего аргумента.

Результатом приведенного ниже запроса:

```sql
SELECT id, full_name, salary,
       LAG(salary, 1, 0) OVER (ORDER BY id) AS prev_employee_salary
FROM Employees;
```

является:

```no-highlight
+----+-----------------+--------+----------------------+
| id | full_name       | salary | prev_employee_salary |
+----+-----------------+--------+----------------------+
| 1  | Sergey Brin     | 10000  | 0                    |
| 2  | John Doerr      | 10000  | 10000                |
| 3  | Larry Page      | 7000   | 10000                |
| 4  | Eric Schmidt    | 8000   | 7000                 |
| 5  | Sundar Pichai   | 11000  | 8000                 |
| 6  | Marissa Mayer   | 9000   | 11000                |
| 7  | Susan Wojcicki  | 8000   | 9000                 |
| 8  | John Smith      | 7000   | 8000                 |
| 9  | Sheryl Sandberg | 9000   | 7000                 |
| 10 | Alice Johnson   | 12000  | 9000                 |
+----+-----------------+--------+----------------------+
```

Здесь функция `LAG()` в случае выхода за рамки окна возвращает число `0`, поскольку именно оно указано в качестве третьего аргумента функции.

Если во время использования функции `LAG()` опустить значение, определяющее то, на сколько запись отстает от текущей, оно по умолчанию примет значение `1`. Аналогичное справедливо и для функции `LEAD()`.

Результатом приведенного ниже запроса:

```sql
SELECT id, full_name, salary,
       LAG(salary) OVER (ORDER BY id) AS prev_employee_salary,
       LEAD(salary) OVER (ORDER BY id) AS next_employee_salary
FROM Employees;
```

является:

```no-highlight
+----+-----------------+--------+----------------------+----------------------+
| id | full_name       | salary | prev_employee_salary | next_employee_salary |
+----+-----------------+--------+----------------------+----------------------+
| 1  | Sergey Brin     | 10000  | NULL                 | 10000                |
| 2  | John Doerr      | 10000  | 10000                | 7000                 |
| 3  | Larry Page      | 7000   | 10000                | 8000                 |
| 4  | Eric Schmidt    | 8000   | 7000                 | 11000                |
| 5  | Sundar Pichai   | 11000  | 8000                 | 9000                 |
| 6  | Marissa Mayer   | 9000   | 11000                | 8000                 |
| 7  | Susan Wojcicki  | 8000   | 9000                 | 7000                 |
| 8  | John Smith      | 7000   | 8000                 | 9000                 |
| 9  | Sheryl Sandberg | 9000   | 7000                 | 12000                |
| 10 | Alice Johnson   | 12000  | 9000                 | NULL                 |
```