

Функция `NTILE()` используется для разбиения окна на заданное количество групп. Она принимает в качестве аргумента целое число `k`, разбивает окно на `k` групп и определяет номер группы, к которой относится запись.

В качестве примера использования функции `NTILE()` напишем запрос, который распределяет всех сотрудников по пяти группам, образуя пары из первого и второго сотрудника, третьего и четвертого, и так далее.

Результатом приведенного ниже запроса:

```sql
SELECT id, full_name,
       NTILE(5) OVER (ORDER BY id) AS group_number
FROM Employees;
```

является:

```no-highlight
+----+-----------------+--------------+
| id | full_name       | group_number |
+----+-----------------+--------------+
| 1  | Sergey Brin     | 1            |
| 2  | John Doerr      | 1            |
| 3  | Larry Page      | 2            |
| 4  | Eric Schmidt    | 2            |
| 5  | Sundar Pichai   | 3            |
| 6  | Marissa Mayer   | 3            |
| 7  | Susan Wojcicki  | 4            |
| 8  | John Smith      | 4            |
| 9  | Sheryl Sandberg | 5            |
| 10 | Alice Johnson   | 5            |
+----+-----------------+--------------+
```

Функция `NTILE()` всегда пытается разбить окно на группы равного размера, однако если окно из `n` записей делится на `k` групп, причем окно невозможно поделить на равные группы (`n` не делится на `k` нацело), то первые `n % k` (остаток от деления `n` на `k`) групп будут содержать ровно на `1` запись больше, чем остальные группы.

Например, если окно из `10` записей делится на `3` группы, то первая группа будет содержать `4` записи, а две остальные — по `3`.

Результатом приведенного ниже запроса:

```sql
SELECT id, full_name,
       NTILE(3) OVER (ORDER BY id) AS group_number
FROM Employees;
```

является:

```no-highlight
+----+-----------------+--------------+
| id | full_name       | group_number |
+----+-----------------+--------------+
| 1  | Sergey Brin     | 1            |
| 2  | John Doerr      | 1            |
| 3  | Larry Page      | 1            |
| 4  | Eric Schmidt    | 1            |
| 5  | Sundar Pichai   | 2            |
| 6  | Marissa Mayer   | 2            |
| 7  | Susan Wojcicki  | 2            |
| 8  | John Smith      | 3            |
| 9  | Sheryl Sandberg | 3            |
| 10 | Alice Johnson   | 3            |
+----+-----------------+--------------+
```

#sql 