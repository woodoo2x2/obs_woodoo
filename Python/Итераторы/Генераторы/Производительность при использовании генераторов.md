Производительность при использовании генераторов

Как уже было сказано, генераторы (генераторные выражения или генераторные функции) идеально подходят, когда необходимо прочитать содержимое большого файла.

Чтобы наглядно показать преимущество использования генераторов, создадим две функции `read_immediately()` и `read_lazy()`, которые читают содержимое текстового файла:

- первая функция читает все непустые строки файла и заносит их в список, который затем возвращает с помощью оператора `return`
- вторая функция читает все непустые строки файла и возвращает их с помощью оператора `yield`

```python
def read_immediately(file_name):
    with open(file_name, 'r', encoding='utf-8') as file:
        result = []
        for line in file:
            line = line.rstrip('\n')
            if line != '':
                result.append(line)
        return result

def read_lazy(file_name):
    with open(file_name, 'r', encoding='utf-8') as file:
        for line in file:
            line = line.rstrip('\n')
            if line != '':
                yield line
```

Запустив указанные функции на файлах разных размеров, получим следующие результаты:

|Размер файла|**return**|   |**yield**|   |
|---|---|---|---|---|
|Память|Время|Память|Время|
|---|---|---|---|
|4 Кбайт|5,3 Мбайт|0.023 с|5,42 Мбайт|0.08 c|
|324 Кбайт|9,98 Мбайт|0.028 с|5,37 Мбайт|0,32 с|
|26 Мбайт|392 Мбайт|27 с|5.52 Мбайт|29.61 с|
|263 Мбайт|3,65 Гбайт|273.56 с|5,55 Мбайт|292,99 с|

Видно, что в обоих случаях время увеличивается с примерно одинаковой скоростью, а количество потребляемой памяти сильно различается. Чем больше обрабатываемый файл, тем заметнее различие.