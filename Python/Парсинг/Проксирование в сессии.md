Проксирование – это технология, которая позволяет перенаправлять сетевые запросы через промежуточный сервер. Это может быть полезно для обхода географических ограничений, улучшения безопасности, а также для выполнения веб-парсинга в контролируемом окружении. 

#### Настройка прокси для одного запроса

Для указания прокси в отдельном запросе достаточно передать аргумент `proxies` в метод запроса, вот так:

```python
import requests

proxies = {
    'http': 'http://10.10.1.10:3128',
    'https': 'http://10.10.1.10:1080',
}

response = requests.get('http://example.org', proxies=proxies)
```

#### Настройка прокси для сессии

Также можно настроить прокси для всей сессии, и эти настройки будут применяться ко всем запросам в этой сессии.

```python
import requests

proxies = {
    'http': 'http://10.10.1.10:3128',
    'https': 'http://10.10.1.10:1080',
}

session = requests.Session()
session.proxies.update(proxies)

response = session.get('http://example.org')
```

Теперь все запросы в этой сессии будут автоматически проксироваться через указанные серверы.

#### Предостережение

Есть один момент: установка `session.proxies` может вести себя не так, как ожидается, потому что заданные значения могут быть перезаписаны системными прокси. Чтобы избежать этого, лучше явно указывать аргумент `proxies` в каждом запросе.

### Примеры кода: продвинутое использование прокси в задачах веб-парсинга.

Давай разберем несколько примеров, которые помогут лучше понять, как можно использовать прокси в реальных задачах веб-парсинга. Это поможет обеспечить анонимность и обойти ограничения доступа на определенные ресурсы.

Для запуска следующих примеров кода, вам понадобится несколько рабочих прокси, [ссылка](https://proxy6.net/?r=408871) на магазин с надёжными прокси.

#### Пример 1: Автоматическое переключение прокси

Можно создать список доступных прокси и автоматически переключаться между ними при возникновении ошибок.

```
import requests
from itertools import cycle

# Список прокси
proxies_list = [
    {'http': 'http://10.10.36.159:8000', 'https': 'https://10.10.36.159:8000'},
    {'http': 'http://10.10.51.205:8000', 'https': 'https://10.10.51.205:8000'},
    {'http': 'http://10.10.79.216:8000', 'https': 'https://10.10.79.216:8000'},
    # ... и так далее
]

proxy_pool = cycle(proxies_list)

url = "http://example.org"

# Создание сессии
session = requests.Session()

for i in range(1, 6):  # Попробуем сделать 5 запросов
    proxy = next(proxy_pool)
    session.proxies.update(proxy)  # Обновление прокси для сессии
    try:
        response = session.get(url, timeout=5)  # Используем сессию для выполнения запроса
        print(f"Request {i}: Success!")
    except requests.exceptions.RequestException as e:
        print(f"Request {i}: Failed, switching proxy. {proxy}")
```

Теперь при возникновении ошибки скрипт автоматически переключится на следующий прокси из списка.

Обратите внимание, что requests поддерживает только HTTP- и HTTPS-прокси. Если вам нужно маршрутизировать HTTP, HTTPS, FTP или другой трафик, вам понадобится SOCKS-прокси. Библиотека не поддерживает его нативно, но вы можете установить расширение socks.

```
pip install requests[socks]
```

Затем вы можете указать использование SOCKS-прокси.

#### Пример 2: Аутентификация на прокси

Если прокси-сервер требует аутентификации, используй следующий способ:

```python
import requests

url = "https://httpbin.org/ip"
proxies = {
    'http': 'socks5://8ZYk5H:XfMpg7@10.10.36.159:8000',
    'https': 'socks5://Kx4Jcj:h4Ch0N@10.10.51.205:8000',
}

# Создаем сессию
session = requests.Session()

# Устанавливаем прокси для сессии
session.proxies.update(proxies)

# Делаем запрос
response = session.get(url)

print(response.text)
```