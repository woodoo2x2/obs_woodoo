

**Нормализация** — это процесс организации данных в реляционной базе данных в соответствии с определенными правилами, которые делают базу данных более гибкой, устраняя избыточность данных и потенциальные ошибки.

Избыточность данных означает наличие повторяющейся или лишней информации в различных частях базы данных. Она приводит к непродуктивному расходованию ресурсов хранилища и затрудняет обслуживание базы данных. Так, в таблице ниже содержится избыточная информация:

|   |   |   |   |
|---|---|---|---|
|**ID**|**Имя**|**Фамилия**|**Предмет**|
|1|Билл|Гейтс|Информатика|
|2|Алан|Тьюринг|Информатика|
|3|Эдгар|Кодд|Математика|

Если, например, название предмета **Информатика** изменится на **Компьютерные науки**, то его нужно будет заменить во всех записях о тех студентах, которые изучают данный предмет. Потенциальная же ошибка может заключаться, например, в потере информации. Если Эдгар решит больше не изучать математику, то придется удалить запись со сведениями о нем, и тогда информация о данном предмете будет полностью потеряна.

Ошибки, которые могут возникнуть при работе с ненормализованной базой данных, называются **аномалиями**. Выделяют аномалии вставки, удаления и модификации, которые возникают при соответствующих операциях.

## Нормальные формы

Существует несколько наборов правил нормализации баз данных. Каждый такой набор называется **нормальной формой**. Если базой данных соблюдается первый набор правил, то считается, что она находится в первой нормальной форме, если первые три набора правил — в третьей нормальной форме. Выражение "привести к нормальной форме" нередко применяется как к отдельной таблице, так и к базе данных в целом. Во втором случае понимается преобразование всех таблиц базы данных так, чтобы каждая из них удовлетворяла необходимым условиям.

Каждая следующая нормальная форма содержит более строгие правила и критерии. Приводя базу данных к определенной нормальной форме, мы устраняем определенный спектр проблем. Таким образом, процесс перехода от одной нормальной формы к следующей представляет собой усовершенствование базы данных. Если база данных находится в какой-либо нормальной форме, это означает, что она лишена определенного вида аномалий.

Приведение базы данных к какой-либо конкретной нормальной форме обязательно требует, чтобы эта база данных уже находилась в предыдущей нормальной форме.

Существует пять основных нормальных форм: **первая, вторая, третья, четвертая** и **пятая** нормальные формы. Иногда выделяют еще три дополнительные формы:

- шестая нормальная форма
- нормальная форма Бойса-Кодда
- доменно-ключевая нормальная форма

База данных считается нормализованной, если она находится как минимум в третьей нормальной форме. Нормализация до третьей нормальной формы является стандартной практикой, так как она устраняет достаточное количество аномалий. Ситуации, при которых требуется нормализовать базу данных до четвертой нормальной формы, встречаются достаточно редко.

Все последующие нормальные формы относятся скорее к теоретическим нормальным формам, и на практике трудно представить ситуации, при которых потребуется нормализовать до них базу.

## Первая нормальная форма

Первая нормальная форма является начальным уровнем нормализации данных. Она включает следующие правила:

- в таблице не должно быть полей с одинаковым смыслом
- в каждой ячейке таблицы должно находиться одиночное несоставное значение
- таблица должна иметь первичный ключ

В качестве примера приведения к первой нормальной форме рассмотрим следующую таблицу:

|   |   |   |   |   |
|---|---|---|---|---|
|**ID**|**Имя**|**Фамилия**|**Первый предмет**|**Второй предмет**|
|1|Билл|Гейтс|Информатика|Маркетинг|
|2|Алан|Тьюринг|Криптография|Математика|
|3|Эдгар|Кодд|Информатика|Математика|

Данная таблица не соответствует первой нормальной форме, так как содержит поля с одинаковым смыслом: `Первый предмет` и `Второй предмет`. В подобных таблицах сложно обеспечивать согласованность данных. Например, если появится студент, изучающий три или четыре предмета, придется целиком изменять структуру таблицы. Потенциальным решением проблемы может являться группировка схожих полей:

|   |   |   |   |
|---|---|---|---|
|**ID**|**Имя**|**Фамилия**|**Предметы**|
|1|Билл|Гейтс|Информатика,  <br>Маркетинг|
|2|Алан|Тьюринг|Криптография,  <br>Математика|
|3|Эдгар|Кодд|Информатика,  <br>Математика|

Однако таблица по-прежнему не находится в первой нормальной форме, так как теперь некоторые ее ячейки содержат составные значения. Решением может быть дублирование записей таким образом, чтобы каждое составное значение стало одиночным:

|   |   |   |   |
|---|---|---|---|
|**ID**|**Имя**|**Фамилия**|**Предмет**|
|1|Билл|Гейтс|Информатика|
|1|Билл|Гейтс|Маркетинг|
|2|Алан|Тьюринг|Криптография|
|2|Алан|Тьюринг|Математика|
|3|Эдгар|Кодд|Информатика|
|3|Эдгар|Кодд|Математика|

Теперь таблица находится в первой нормальной форме, так как она не имеет схожих по смыслу полей, в каждой ее ячейке находится одиночное значение, а первичным ключом в ней является сочетание полей `ID` и `Предмет`. Несмотря на это, она подвержена аномалиям. В частности, в данную таблицу нельзя внести информацию о студенте, не указав хотя бы один изучаемый предмет, а также невозможно удалить информацию обо всех изучаемых студентом предметах, не удалив информацию о нем самом.

## Вторая нормальная форма

Вторая нормальная форма является продолжением первой нормальной формы и включает следующие правила:

- таблица должна находиться в первой нормальной форме
- каждое неключевое поле таблицы должно зависеть только от полного первичного ключа, то есть от всех его полей

В качестве примера приведения ко второй нормальной форме рассмотрим предложенную ранее таблицу, которая уже находится в первой нормальной форме, однако для большей наглядности последующих рассуждений добавим в нее еще одно поле:

|   |   |   |   |   |
|---|---|---|---|---|
|**ID**|**Имя**|**Фамилия**|**Предмет**|**Оценка**|
|1|Билл|Гейтс|Информатика|5|
|1|Билл|Гейтс|Маркетинг|4|
|2|Алан|Тьюринг|Криптография|5|
|2|Алан|Тьюринг|Математика|5|
|3|Эдгар|Кодд|Информатика|5|
|3|Эдгар|Кодд|Математика|5|

Несложно показать, что данная таблица не находится во второй нормальной форме. Например, в ней существуют зависимость поля `Оценка` от полей `ID` и `Предмет` (оценка зависит от студента и предмета), а также зависимость полей `Имя` и `Фамилия` от поля `ID` (персональная информация студента зависит только от него самого). Таким образом, поля `Имя` и `Фамилия` зависят не от полного первичного ключа, а лишь от его части, так как первичным ключом является сочетание полей `ID` и `Предмет`, но при этом поле `Предмет` можно убрать без потери зависимости.

Чтобы привести данную таблицу ко второй нормальной форме, необходимо разбить ее на несколько таблиц с учетом всех неполных зависимостей. В нашем случае неполную зависимость образуют поля `Имя` и `Фамилия`, поэтому их следует вынести в отдельную таблицу:

|   |   |   |
|---|---|---|
|**ID**|**Имя**|**Фамилия**|
|1|Билл|Гейтс|
|2|Алан|Тьюринг|
|3|Эдгар|Кодд|

Тогда исходная таблица примет следующий вид:

|   |   |   |
|---|---|---|
|**ID**|**Предмет**|**Оценка**|
|1|Информатика|5|
|1|Маркетинг|4|
|2|Криптография|5|
|2|Математика|5|
|3|Информатика|5|
|3|Математика|5|

Теперь мы имеем две таблицы, каждая из которых находится во второй нормальной форме. Также можно заметить, что после этого разбиения персональные данные студента и информация о его успеваемости стали независимыми. Это значит, что больше нет части аномалий, свойственных первой нормальной форме: вставка и удаление данных не затрагивают информацию, не связанную с ними напрямую.

 Процесс разбиения одной большой таблицы на несколько меньших таблиц называется **декомпозицией**.

## Третья нормальная форма

Третья нормальная форма исправляет оставшиеся после приведения ко второй нормальной форме аномалии и включает следующие правила: 

- таблица должна находиться во второй нормальной форме
- каждое неключевое поле таблицы должно зависеть только от первичного ключа и ни от какого другого неключевого поля

Другими словами, третья нормальная форма говорит о том, что неключевые поля не должны вести себя как первичные ключи. Они не должны давать возможности получить данные из других полей, так как их задачей является лишь предоставление той информации, которая находится в них самих.

В качестве примера приведения к третьей нормальной форме рассмотрим следующую таблицу, которая уже находится во второй нормальной форме:

|   |   |   |   |   |
|---|---|---|---|---|
|**ID**|**Имя**|**Фамилия**|**Должность**|**Зарплата**|
|1|Билл|Гейтс|Программист|120 000|
|2|Алан|Тьюринг|Криптограф|100 000|
|3|Эдгар|Кодд|Программист|120 000|

Данная таблица содержит список сотрудников с указанием их должностей и размеров заработной платы. Первичным ключом в ней является поле `ID`. При этом известно, что размер заработной платы сотрудника полностью определяется занимаемой должностью. Следовательно, существует зависимость поля `Зарплата` от поля `Должность`, что делает таблицу не соответствующей требованиям третьей нормальной формы, и в ней есть аномалии модификации. Например, если Алан решит стать программистом, его зарплата все равно останется на прежнем уровне.

Таблица во второй нормальной форме приводится к третьей способом, похожим на то, как первая нормальная форма приводится ко второй — путем декомпозиции с учетом всех неудовлетворяющих зависимостей. В нашем случае неудовлетворяющую зависимость образует поле `Зарплата`, поэтому его следует вынести в отдельную таблицу:

|   |   |   |
|---|---|---|
|**Код должности**|**Должность**|**Зарплата**|
|1|Программист|120 000|
|2|Криптограф|100 000|

Тогда исходная таблица примет следующий вид:

|   |   |   |   |
|---|---|---|---|
|**ID**|**Имя**|**Фамилия**|**Код занимаемой должности**|
|1|Билл|Гейтс|1|
|2|Алан|Тьюринг|2|
|3|Эдгар|Кодд|1|

Теперь мы имеем две таблицы, каждая из которых находится в третьей нормальной форме. Благодаря этому аномалия модификации больше не проявляется, и любой сотрудник после смены должности автоматически получит корректное изменение заработной платы.

Также следует заметить, что в таблице с информацией о должностях каждой должности был присвоен уникальный код, который используется в таблице с работниками для указания занимаемой должности. Теперь если мы решим переименовать должность **Программист** в **Разработчик**, это нужно будет сделать лишь единожды, а не изменять должность каждого работника, являющегося программистом.

Приводить базу данных к третьей нормальной форме для устранения всех зависимостей не всегда практично. Значительное увеличение числа маленьких таблиц может привести к снижению производительности при работе с базой данных.

 Нормализация предназначена для приведения структуры базы данных к виду, обеспечивающему минимальную логическую избыточность, и не имеет целью уменьшение или увеличение производительности работы или же уменьшение или увеличение физического объема базы данных.

Если в таблице имеется только один потенциальный первичный ключ и он состоит только из одного поля, то соответствие таблицы первой нормальной форме автоматически делает таблицу соответствующей второй нормальной форме.

 Помимо нормализации, существует процесс, называемый **денормализацией**. Денормализация заключается в намеренном приведении структуры базы данных в состояние, не соответствующее определенным нормальным формам. Обычно денормализация используется с целью ускорения операций чтения из базы данных за счет добавления избыточных данных.

