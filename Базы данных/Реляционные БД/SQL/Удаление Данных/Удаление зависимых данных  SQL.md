Практически всегда база данных состоит из большого количества таблиц, которые определенным образом связаны между собой с помощью внешних ключей. Поэтому закономерно может произойти ситуация, при которой выполняется попытка удаления записи, от значений которой зависят другие записи.

Вернемся к рассмотрению нашей базы данных. В таблице `Books` хранятся данные о книгах. Для каждой книги определен собственный автор, однако подробные данные об этих авторах находятся не в таблице `Books`, а в таблице `Authors`. Сама же таблица `Books` лишь ссылается на эти данные посредством внешнего ключа — поля `author_id`.

Теперь предположим, что мы хотим удалить информацию о каком-либо авторе из таблицы `Authors`. Если книги этого автора содержатся в таблице `Books`, то такое удаление может привести к нарушению целостности данных, так как в таблице `Books` будет существовать книга с неизвестным автором.

К счастью, при использовании внешних ключей СУБД запрещает удаление записей, которые обеспечивают корректность отношений между таблицами, и при попытке выполнить подобное удаление сообщает об ошибке.

Результатом приведенного ниже запроса:

```sql
DELETE FROM Authors
WHERE author = 'Jerome Salinger';
```

является ошибка:

```no-highlight
ERROR 1451: Cannot delete or update a parent row: a foreign key constraint fails 
```

Запрос выше пытается удалить из таблицы `Authors` запись с данными об авторе `Jerome Salinger`, однако операция завершается с ошибкой, поскольку в таблице `Books` содержится запись, которая ссылается на удаляемые данные.

Для того чтобы корректно удалить данные, от которых могут зависеть другие данные, сперва необходимо избавиться от всех потенциальных зависимостей или убедиться, что таких зависимостей нет. В нашем случае для удаления информации об авторе `Jerome Salinger` сначала нужно удалить информацию обо всех принадлежащих ему книгах.

После выполнения приведенного ниже запроса:

```sql
DELETE FROM Books
WHERE author_id = (SELECT id
                   FROM Authors
                   WHERE author = 'Jerome Salinger');

DELETE FROM Authors
WHERE author = 'Jerome Salinger';
```

 таблица `Books` будет иметь вид:

```no-highlight
+----+----------------+-----------+
| id | title          | author_id |
+----+----------------+-----------+
| 1  | The Shining    | 1         |
| 2  | Fight Club     | 2         |
| 4  | The Green Mile | 1         |
| 5  | Haunted        | 2         |
+----+----------------+-----------+
```

таблица `Authors` будет иметь вид:

```no-highlight
+----+-----------------+
| id | author          |
+----+-----------------+
| 1  | Stephen King    |
| 2  | Chuck Palahniuk |
+----+-----------------+
```

Здесь сперва выполняется обращение к таблице `Books`, из которой удаляются все данные о книгах, автором которых является `Jerome Salinger`, а затем происходит обращение к таблице `Authors`, из которой уже удаляются данные о самом авторе.

)СУБД запрещает удалять зависимые данные только в том случае, если эта зависимость явно определена. Если между таблицами не существует никакой связи, СУБД не будет следить за целостностью данных в таких таблицах.

#sql